#include "display_functions.h"
#include "font8x8_basic.h"
#include "setup.h"

static uint8_t logo_image[1024] = {
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xfc, 0x00, 0x00, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xfc, 0x00, 0x00, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xfc, 0x00, 0x00, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xfc, 0x00, 0x00, 0x00, 0x07, 0x8f, 0x1f, 0x1e, 0x1e, 0x07, 0x00, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xfc, 0x00, 0x00, 0x00, 0x0e, 0x03, 0x0f, 0x1e, 0x1e, 0x03, 0x00, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x0e, 0x23, 0x0e, 0x1e, 0x1e, 0x01, 0x81, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x0e, 0x73, 0x0e, 0x1e, 0x1e, 0x39, 0xe7, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x0e, 0x7f, 0x0e, 0x1c, 0x0e, 0x39, 0xe7, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x0e, 0x3f, 0x04, 0x1c, 0xce, 0x39, 0xe7, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x0f, 0x0f, 0x24, 0x9c, 0xce, 0x31, 0xe7, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x0f, 0x83, 0x20, 0x1c, 0xce, 0x03, 0xe7, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x0f, 0xe3, 0x31, 0x1c, 0xce, 0x07, 0xe7, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x1f, 0xf1, 0x31, 0x18, 0x06, 0x23, 0xe7, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x1c, 0x71, 0x11, 0x18, 0x06, 0x23, 0xe7, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x00, 0x00, 0x00, 0x1c, 0x23, 0x1b, 0x98, 0xe6, 0x33, 0xe7, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x00, 0x00, 0x00, 0x1e, 0x03, 0x1f, 0x99, 0xe6, 0x31, 0xe7, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x00, 0x00, 0x00, 0x1f, 0x07, 0x1f, 0x91, 0xe2, 0x39, 0xe7, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x00, 0x00, 0x00, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x00, 0x00, 0x00, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x00, 0x00, 0x00, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x00, 0x00, 0x00, 0x1e, 0x73, 0xce, 0x38, 0x06, 0x06, 0x0f, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x00, 0x00, 0x00, 0x1c, 0x73, 0x8e, 0x18, 0x04, 0x06, 0x03, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x00, 0x00, 0x00, 0x3c, 0x71, 0x8e, 0x18, 0x04, 0x06, 0x03, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x80, 0x00, 0x00, 0x3e, 0x71, 0x8c, 0x1f, 0x3c, 0x7e, 0x71, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x80, 0x00, 0x00, 0x3e, 0x61, 0x9c, 0x9f, 0x3c, 0x7e, 0x71, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x80, 0x00, 0x00, 0x3e, 0x21, 0x9c, 0x9f, 0x3c, 0x7e, 0x71, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x80, 0x00, 0x00, 0x3e, 0x21, 0x9c, 0x8f, 0x3c, 0x06, 0x71, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x80, 0x00, 0x00, 0x3f, 0x24, 0x18, 0xcf, 0x3c, 0x06, 0x03, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x80, 0x00, 0x00, 0x3f, 0x04, 0x18, 0xcf, 0x3c, 0x7e, 0x07, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x80, 0x00, 0x00, 0x3f, 0x0c, 0x38, 0x0f, 0x3c, 0x7e, 0x07, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0x80, 0x00, 0x00, 0x3f, 0x0c, 0x38, 0x07, 0x3c, 0x7e, 0x63, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xc0, 0x00, 0x00, 0x7f, 0x0e, 0x39, 0xc7, 0x3c, 0x7e, 0x63, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xc0, 0x00, 0x00, 0x7f, 0x8e, 0x31, 0xe7, 0x3c, 0x06, 0x73, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xc0, 0x00, 0x00, 0x7f, 0x8e, 0x31, 0xe7, 0x3e, 0x06, 0x71, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xc0, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xf0, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00,
	0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00
};


void init_display(SSD1306_t* dev) {
    ssd1306_init(dev, 128, 64);

    ssd1306_clear_screen(dev, false);
    ssd1306_contrast(dev, 0xff);
}

void welcome_screen(SSD1306_t* dev) {
    ssd1306_clear_screen(dev, false);
	ssd1306_bitmaps(dev, 0, 0, logo_image, 128, 64, false);
}

void pouring_finished_screen(SSD1306_t* dev) {
    ssd1306_display_text(dev, 1, "Pouring finished!", 17, false);
    ssd1306_display_text(dev, 3, "Take your water", 15, false);
    ssd1306_display_text(dev, 5, "Please", 6, false);
}

void factory_reset_screen(SSD1306_t* dev, uint8_t time_to_restart) {
    char text[25];
    sprintf(text, "Restarting in %d s", time_to_restart);
    ssd1306_display_text(dev, 3, text, 25, false);
}

void failed_to_connect_to_wifi_screen(SSD1306_t* dev) {
	ssd1306_display_text(dev, 0, "Cannot connect", 15, false);
	ssd1306_display_text(dev, 1, "to WiFi!", 8, false);
	ssd1306_display_text(dev, 4, "Please check", 12, false);
	ssd1306_display_text(dev, 5, "if your WiFi is", 15, false);
	ssd1306_display_text(dev, 6, "on and start", 12, false);
	ssd1306_display_text(dev,7, "the device again", 16, false);
}

void wifi_connection_attempt_screen(SSD1306_t* dev, uint8_t attempt_number, uint8_t max_attempts) {
	ssd1306_display_text(dev, 1, "Connecting...", 13, false);
	char text[16];
	if(attempt_number <= 99 && max_attempts <= 99) {
		sprintf(text, "Attempt %02d / %02d", attempt_number, max_attempts);
	}
	ssd1306_display_text(dev, 5, text, 16, false);
}

void pouring_tag_info_screen(SSD1306_t* dev, uint16_t milliliters) {
	char text[17];
	sprintf(text, "Pouring %3d ml", milliliters);
	ssd1306_display_text(dev, 4, text, 17, false);
}

void pouring_manual_info_screen(SSD1306_t* dev, uint16_t milliliters) {
	char text[16];
	sprintf(text, "Poured %3d ml", milliliters);
	ssd1306_display_text(dev, 1, text, 16, false);

	ssd1306_display_text(dev, 3, "Take your water", 15, false);
	ssd1306_display_text(dev, 5, "Please", 6, false);
}

void pouring_max_capacity_limit_trig_info_screen(SSD1306_t* dev) {
	ssd1306_display_text(dev, 0, "Cannot pour", 11, false);
	ssd1306_display_text(dev, 1, "specified", 9, false);
	ssd1306_display_text(dev, 2, "amount of water", 15, false);

	ssd1306_display_text(dev, 5, "Current limit:", 15, false);
	char text[7];
	sprintf(text, "%3d ml", MAX_POUR_MILLILITERS);
	ssd1306_display_text(dev, 6, text, 7, false);
}

void refill_water_tank_info_screen(SSD1306_t* dev) {
	ssd1306_display_text(dev, 1, "Please refill", 13, false);
	ssd1306_display_text(dev, 5, "the water tank", 14, false);
}

